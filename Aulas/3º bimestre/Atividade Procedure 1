create table usuarios (
id int auto_increment primary key,
nome varchar(100),
usuario varchar(50),
senha varchar(100)
);

delimiter $$
create procedure autentica_usuario(
in p_usuario varchar(50),
in p_senha varchar(100),
out p_autenticado int
)
begin select count(*) into p_autenticado
from usuarios
where usuario = p_usuario and senha = p_senha;
end$$
delimiter ;

--------------------------------------------------PARTE 2--------------------------------------------------

create table locais (
id int auto_increment primary key,
nome_cliente varchar(100),
cidade varchar(50),
estado varchar(50),
regiao varchar(50)
);

delimiter $$
create procedure inserir_local(
in p_nome_cliente varchar(100),
in p_cidade varchar(50),
in p_estado varchar(50),
in p_regiao varchar(50)
)
begin 
insert into locais (nome_cliente, cidade, estado, regiao) values
(p_nome_cliente, p_cidade, p_estado, p_regiao);
end $$
delimiter ;

delimiter $$
create procedure clicidade (in p_cidade varchar(50))
begin
select * from locais
where cidade = p_cidade;
end $$
delimiter;


delimiter //
create procedure contaclientecidade (
in p_cidade varchar(50),
out total int
)
begin select count(*) into total
from locais
where cidade = p_cidade;
end //



delimiter //
create procedure verificarregioes (
in p_cidade varchar(50),
out mensagem varchar(100)
)
begin 
declare reg varchar(50);
select regiao into reg from locais where cidade = p_cidade limit 1;
if reg is null then
set mensagem = 'Cidade não encontrada';
elseif reg = 'Sudeste' then
set mensagem = concat('A cidade ', p_cidade, ' está na rigião sudeste');
else
set mensagem = concat('A cidade ', p_cidade, ' está em outra região');
end if;
end //

call verificarregioes ('São Paulo', @msg);
select @msg

delimiter //
create procedure contarregioes (
in p_regiao varchar(50),
out total int 
)
begin
declare contador int default 0;
declare atual int default 0;
select count(*) into total from locais where regiao = p_regiao;
set contador = total;
set atual = 0;
while atual < contador do
set atual = atual +1;
end while;
end //

call contarregioes ('Sudeste', @total);
select @total

delimiter //
create procedure inserirlocalloop ()
begin
declare i int default 1;
loop_inserir: loop
if i > 3 then 
leave loop_inserir;
end if;
insert into locais(nome_cliente, cidade, estado, regiao)
values (concat('cliente ', i), 'Cidade Exemplo', 'EX', 'Região X');
set i = i + 1;
end loop loop_inserir;
end //
