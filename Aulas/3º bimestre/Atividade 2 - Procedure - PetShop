create table cliente(
CPFCli char(11) not null unique,
nome varchar(100) not null,
constraint PKCliente primary key(CPFCli)
);

create table animal(
IDAnimal int auto_increment,
nomeanimal varchar(100) not null,
tipo varchar(100) not null,
ClienteCPF char(11) not null,
constraint PKAnimal primary key(IDAnimal),
constraint FKDonoAnimal foreign key (ClienteCPF) references cliente(CPFCli)
);

create table funcionario(
CPFfun char(11) not null unique,
nomefun varchar(100) not null,
endereco varchar(100) not null,
telefone varchar(20) not null,
funcao varchar(100) not null,
constraint PKFunc primary key(CPFfun)
);

create table produto (
IDProd int auto_increment,
nome varchar(150) not null,
descricao varchar(150) not null,
preco decimal(10, 2) not null,
estoque int not null,
constraint PKProd primary key(idprod)
);

create table compra(
IDCompra int auto_increment,
ClienteCPF char(11) not null,
FunCPF char(11) not null,
vaolrtotal decimal(10,2) not null,
data date not null,
constraint PKCompra primary key(IDCompra),
constraint FKCompraCliCPF foreign key (clientecpf) references cliente(cpfcli),
constraint FKCompraFunCPF foreign key(funcpf) references funcionario(cpffun)
);

create table compraproduto (
compraid int not null,
prodid int not null,
constraint PKCompraProduto primary key(compraid, prodid),
constraint FKProdCompCompra foreign key(compraid) references compra(idcompra),
constraint FKProdCompProd foreign key (prodid) references produto(idprod)
);


create table servicoanimal(
IDServico int auto_increment,
ClienteCPF char(11) not null,
CPFFun char(11) not null,
AnimalID int not null,
descricaoservico varchar(100) not null,
preco decimal(10,2) not null,
data date not null,
constraint PKServico primary key(IDServico),
constraint FKCPFCli foreign key (ClienteCPF) references cliente(CPFCli),
constraint FKCPFFun foreign key (CPFFun) references funcionario(CPFFun),
constraint FKAnimalserv foreign key (AnimalID) references animal(IDAnimal)
);

create view relatorio_compras as
select     
cliente.cpfcli,
funcionario.nomefun,
compra.idcompra,
produto.nome as nomeproduto,
compra.vaolrtotal as valortotal,
compra.data
from compra
join cliente on compra.clientecpf = cliente.cpfcli
join funcionario on compra.funcpf = funcionario.cpffun
join compraproduto on compraproduto.compraid = compra.idcompra
join produto on compraproduto.prodid = produto.idprod;

create view Boletim_Servicos as
select
cliente.cpfcli,
animal.nomeanimal,
servicoanimal.descricaoservico,
funcionario.nomefun,
servicoanimal.preco,
servicoanimal.data
    from servicoanimal
    join cliente on servicoanimal.Clientecpf = cliente.CPFCli
    join animal on servicoanimal.AnimalID = animal.idanimal
    join funcionario on servicoanimal.CPFFun = funcionario.cpffun;


delimiter //
create procedure servicpf (
in p_cpfcli char(11),
out descricaoservico varchar(100)
)
select * from boletim_servicos where cpfcli = p_cpfcli;
select into descricaoservico from servicoanimal;
end //

call servicpf(12345678901, @descricaoservico)

delimiter //
create procedure apos (
in p_data date
)
begin
select * from boletim_servicos where data >= p_data;
end // 

delimiter //
create procedure Relatorio_Compras_Por_Periodo (
in p_data date
)
begin 
select 
cliente.nome,
funcionario.nomefuncionario,
produto.nome as nomeproduto,




DELIMITER //

CREATE PROCEDURE Relatorio_Compras_Por_Periodo()
BEGIN
    SELECT 
        co.IDCompra,
        co.data,
        c.nome AS nome_cliente,
        f.nomefun AS nome_funcionario,
        p.nome AS nome_produto,
        cp.quantidade,
        p.preco,
        (cp.quantidade * p.preco) AS valor_total_produto,
        co.vaolrtotal AS valor_total_compra
    FROM 
        compra co
    JOIN cliente c ON co.ClienteCPF = c.CPFCli
    JOIN funcionario f ON co.FunCPF = f.CPFfun
    JOIN compraproduto cp ON co.IDCompra = cp.compraid
    JOIN produto p ON cp.prodid = p.IDProd
    WHERE 
        co.data BETWEEN '2025-01-01' AND '2025-09-10'
    ORDER BY 
        co.data, co.IDCompra, p.nome;
END //

DELIMITER ;


delimiter //
create procedure relatorio_comprar_por_periodo()
begin
select
compra.idcompra,
compra.data,
cliente.nome as nomecliente,
funcionario.nomefun as nomefuncionario,
produto.nome as nomeproduto,
compraproduto.quantidade,
produto.preco,
(compraproduto.quantidade * produto.preco) as valortotal,
co.vaolrtotal as valortotal
from compra
join cliente on compra.clientecpf = compra.cpfcli
join funcionario on compra.funcpf = funcionario.cpffun
join compraproduto on compra.idcompra = compraproduto = compraid
join produto on compraproduto.prodid = produto.idprod
where compra.data between '2025-01-01' and '2025-09-10'
order by
compra.data, compra.idcompra, produto.nome;
end //
